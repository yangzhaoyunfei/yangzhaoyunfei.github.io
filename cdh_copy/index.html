<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Hadoop-CDH发行版--集群离线部署教程 - $hell's blog</title><meta name=Description content="在裸机上自己部署一个Hadoop集群"><meta property="og:title" content="Hadoop-CDH发行版--集群离线部署教程"><meta property="og:description" content="在裸机上自己部署一个Hadoop集群"><meta property="og:type" content="article"><meta property="og:url" content="https://yangzhaoyunfei.github.io/cdh_copy/"><meta property="og:image" content="https://yangzhaoyunfei.github.io/logo.png"><meta property="article:published_time" content="2020-03-18T17:36:42+08:00"><meta property="article:modified_time" content="2020-07-05T19:15:43+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://yangzhaoyunfei.github.io/logo.png"><meta name=twitter:title content="Hadoop-CDH发行版--集群离线部署教程"><meta name=twitter:description content="在裸机上自己部署一个Hadoop集群"><meta name=application-name content="$hell"><meta name=apple-mobile-web-app-title content="$hell"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://yangzhaoyunfei.github.io/cdh_copy/><link rel=prev href=https://yangzhaoyunfei.github.io/chocolatey-install/><link rel=next href=https://yangzhaoyunfei.github.io/git/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><meta name=google-site-verification content="g_3m80yS6H-NDrYM35d7MxVGJhGNvBnip5KssLC76RA"><meta name=baidu-site-verification content="whwPY7pvsL"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Hadoop-CDH发行版--集群离线部署教程","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yangzhaoyunfei.github.io\/cdh_copy\/"},"image":["https:\/\/yangzhaoyunfei.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"大数据, Hadoop, 部署","wordcount":7940,"url":"https:\/\/yangzhaoyunfei.github.io\/cdh_copy\/","datePublished":"2020-03-18T17:36:42+08:00","dateModified":"2020-07-05T19:15:43+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/yangzhaoyunfei.github.io\/images\/avatar.png"},"author":{"@type":"Person","name":"$hell"},"description":"在裸机上自己部署一个Hadoop集群"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="$hell's blog"><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>$hell</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/categories/documentation/>文档 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/yangzhaoyunfei title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/cdh_copy/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="$hell's blog"><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>$hell</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/categories/documentation/>文档</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/yangzhaoyunfei title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/cdh_copy/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Hadoop-CDH发行版--集群离线部署教程</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://yangzhaoyunfei.github.io/about/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>$hell</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/big-data/><i class="far fa-folder fa-fw"></i>big data</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-03-18>2020-03-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 7940 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 16 分钟&nbsp;<span id=/cdh_copy/ class=leancloud_visitors data-flag-title=Hadoop-CDH发行版--集群离线部署教程>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#前情概要>前情概要</a></li><li><a href=#系统要求>系统要求</a></li></ul><ul><li><a href=#centos-local-yum-repo-准备>centos local yum repo 准备</a><ul><li><a href=#利用iso制作本地yum源-http制作yum源镜像服务器>利用iso制作本地yum源, http制作yum源镜像服务器</a></li></ul></li><li><a href=#centos-http-yum-repo-准备>centos http yum repo 准备</a><ul><li><a href=#安装web服务器>安装web服务器</a></li><li><a href=#为其他机器配置-http-yum源>为其他机器配置 http yum源</a></li></ul></li><li><a href=#cmcdhrpm-repo库>cm/cdh(rpm) repo库</a></li><li><a href=#cdhparcel库>cdh(parcel)库</a></li><li><a href=#设置ntp集群时间同步>设置NTP(集群时间同步)</a></li><li><a href=#优化内核参数>优化内核参数</a><ul><li><a href=#关闭ipv6>关闭ipv6</a></li></ul></li><li><a href=#jdk准备脚本中已有spark2依赖jdk8所以自定义安装8>jdk准备(脚本中已有,spark2依赖jdk8,所以自定义安装8)</a></li><li><a href=#cmcms安装>cm/cms安装</a></li><li><a href=#databaseconnector-安装相关数据库准备>database,connector 安装,相关数据库准备</a><ul><li><a href=#安装和配置数据库>安装和配置数据库</a></li><li><a href=#为mariadb安装mysql-jdbc驱动程序>为MariaDB安装MySQL JDBC驱动程序</a></li><li><a href=#为cloudera-software创建数据库元数据库>为Cloudera Software创建数据库(元数据库)</a></li><li><a href=#设置cloudera-manager数据库>设置Cloudera Manager数据库</a></li></ul></li><li><a href=#安装cdh>安装cdh</a><ul><li><a href=#设置本地-parcel-存储库-url>设置本地 parcel 存储库 url</a></li><li><a href=#如果之前安装了jdk-jdk选择页面-不要勾选-安装jdk>如果之前安装了jdk, jdk选择页面 <code>不要勾选</code> <code>安装JDK</code></a></li><li><a href=#单用户模式配置复杂不要勾选>单用户模式配置复杂,不要勾选</a></li><li><a href=#install-agents>Install Agents</a></li><li><a href=#正在安装选定-parcel>正在安装选定 Parcel</a></li><li><a href=#检查主机正确性>检查主机正确性</a></li><li><a href=#数据库设置>数据库设置</a></li><li><a href=#审核更改>审核更改</a></li><li><a href=#首次运行-命令>首次运行 命令</a></li><li><a href=#恭喜>恭喜</a></li><li><a href=#系统配置优化可选>系统配置优化(可选)</a></li></ul></li><li><a href=#待完善>待完善</a></li><li><a href=#附件>附件</a><ul><li><a href=#附件1>附件1</a></li><li><a href=#附件2>附件2</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>为贴近真实环境,本文档假设以下条件:</p><p>1.集群中各机器无法连接外网,只能通过内网向集群发送文件<br>2.集群内各机器间网络互通<br>3.操作者拥有集群内各机器的root权限</p><h2 id=前情概要>前情概要</h2><blockquote><p>cloudera cdh分为cm(管理组件),cdh(hadoop组件)两大基础部分,当然还有,Navigator,impala等组件.<br>cm安装方式: rpm ,存储库方式: 在线repo/内部(http)repo/本地rpm<br>cdh安装方式: rpm/parcel ,存储库方式: 在线repo/内部(http)repo<br>jdk安装方式: rpm/exec ,存储库: cloudera在线repo/cloudera内部repo/oracle tarball</p></blockquote><h2 id=系统要求>系统要求</h2><ol><li>jdk(这一步放到了脚本中)
从上面配置好的apache上下载,集群每个主机必须安装受支持的统一版本,Cloudera强烈建议安装在<code>/usr/java/jdk-version</code>目录下,这样可以自动检测到它</li></ol><h1 id=系统环境准备>系统环境准备</h1><h2 id=centos-local-yum-repo-准备>centos local yum repo 准备</h2><h3 id=利用iso制作本地yum源-http制作yum源镜像服务器>利用iso制作本地yum源, http制作yum源镜像服务器</h3><p>1.挂载iso,并复制文件供http挂载(vm虚拟机上该方案有可能因inode不足而失败,提供备选方案)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 复制到大量文件到某一目录下可能出现inode节点数不足或空间不足的现象,需要预先处理</span>

mkdir -p /data/iso
mount -o loop -t iso9660 /home/yangzhaoyunfei/CentOS-7-x86_64-Everything-1804.iso  /data/iso
mkdir -p /data/centos7
cp -rf  /data/iso/*  /data/centos7
umount /data/iso/

<span class=c1># vw虚拟机上使用如下脚本</span>
mkdir -p /data/iso
mount /dev/cdrom  /data/iso
mkdir -p /data/centos7
cp -rf  /data/iso/*  /data/centos7
umount /data/iso/

</code></pre></td></tr></table></div></div><p>2.制作并只启用本地yum源(因为无法连接外网,所以必须使用本地源)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> /etc/yum.repos.d/
ll
<span class=c1># 备份原repo文件</span>
<span class=k>for</span> file in <span class=sb>`</span>ls<span class=sb>`</span> <span class=p>;</span><span class=k>do</span> sudo mv <span class=nv>$file</span> <span class=nv>$file</span><span class=s2>&#34;bak&#34;</span><span class=p>;</span><span class=k>done</span>
ll

cat&gt;/etc/yum.repos.d/local.repo<span class=s>&lt;&lt;EOF
</span><span class=s>[local] 
</span><span class=s>name=local
</span><span class=s>baseurl=file:///data/centos7
</span><span class=s>enabled=1
</span><span class=s>gpgcheck=0 
</span><span class=s>EOF</span>

<span class=c1>#验证</span>
yum clean all
yum makecache

</code></pre></td></tr></table></div></div><h2 id=centos-http-yum-repo-准备>centos http yum repo 准备</h2><h3 id=安装web服务器>安装web服务器</h3><blockquote><p>前置要求: local repo</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 禁用防火墙</span>
systemctl stop firewalld.service
systemctl disable firewalld.service
<span class=c1># 禁用selinux</span>
sed -i <span class=s1>&#39;/SELINUX/s/enforcing/disabled/&#39;</span> /etc/selinux/config
reboot

yum install -y httpd
systemctl <span class=nb>enable</span> httpd
systemctl start httpd
<span class=c1># 软链接挂载</span>
<span class=nb>cd</span> /var/www/html <span class=o>&amp;&amp;</span> ll
ln -s /data/centos7/ /var/www/html/centos7 <span class=o>&amp;&amp;</span> ll

</code></pre></td></tr></table></div></div><p>访问浏览器<a href=http://192.168.181.128/centos7 target=_blank rel="noopener noreffer">http_yum</a>测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 如果无法访问,检查firewall,检查selinux,正确配置后重启</span>
<span class=c1># service httpd restart</span>
</code></pre></td></tr></table></div></div><h3 id=为其他机器配置-http-yum源>为其他机器配置 http yum源</h3><blockquote><p>上一步制作的local.repo可以启用,统一采用http.repo</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>mv /etc/yum.repos.d/local.repo /etc/yum.repos.d/local.repobak <span class=o>&amp;&amp;</span> ll /etc/yum.repos.d/

cat&gt;/etc/yum.repos.d/http.repo<span class=s>&lt;&lt;EOF
</span><span class=s>[http] 
</span><span class=s>name=http
</span><span class=s>baseurl=http://192.168.181.128/centos7
</span><span class=s>enabled=1
</span><span class=s>gpgcheck=0 
</span><span class=s>EOF</span>

ll /etc/yum.repos.d/
yum clean all
yum makecache

</code></pre></td></tr></table></div></div><p>将下载的jdk也挂载到http中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>mkdir -p /data/softwares/ 
<span class=c1># 将jdk,jdbc驱动等放到这个文件夹中</span>
ln -s /data/softwares/ /var/www/html/softwares

</code></pre></td></tr></table></div></div><p>访问浏览器<a href=http://192.168.181.128/softwares target=_blank rel="noopener noreffer">http_softwares</a>验证</p><h2 id=cmcdhrpm-repo库>cm/cdh(rpm) repo库</h2><p>1.下载Tarball</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>Cloudera Manager 5: https://archive.cloudera.com/cm5/repo-as-tarball/
</code></pre></td></tr></table></div></div><p>2.解压缩tarball，将文件移动到Web服务器目录，然后修改文件权限</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>tar xvfz cm5.15.1-centos7.tar.gz
sudo mv cm /var/www/html
sudo chmod -R ugo+rX /var/www/html/cm

</code></pre></td></tr></table></div></div><p>访问<a href=http://192.168.181.128/cm target=_blank rel="noopener noreffer">cm_rpms</a>验证是否正确设置
3.创建repo文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>cat&gt;/etc/yum.repos.d/cloudera-repo.repo<span class=s>&lt;&lt;EOF
</span><span class=s>[cloudera-repo]
</span><span class=s>name=cloudera-repo
</span><span class=s>baseurl=http://192.168.181.128/cm/5
</span><span class=s>enabled=1
</span><span class=s>gpgcheck=0
</span><span class=s>EOF</span>

yum clean all
yum makecache

</code></pre></td></tr></table></div></div><h2 id=cdhparcel库>cdh(parcel)库</h2><p>1.先从cloudera官网下载对应系统平台的 ***parcel and manifest.json and sha1 文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>CDH 5: Impala, Kudu, Spark 1, and Search are included in the CDH parcel.
    CDH - https://archive.cloudera.com/cdh5/parcels/
    Accumulo - - https://archive.cloudera.com/accumulo-c5/parcels/
    GPL Extras - https://archive.cloudera.com/gplextras5/parcels/
Cloudera Distribution of Apache Spark 2 for CDH 5:
    The exact parcel name is dependent on the OS. You can find all the parcels at https://archive.cloudera.com/spark2/parcels/.
Sqoop Connectors:
    https://archive.cloudera.com/sqoop-connectors/parcels/
</code></pre></td></tr></table></div></div><p>1.移动<code>.parcel, .sha1 and manifest.json</code>文件到web server目录,然后修改权限</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo mkdir -p /var/www/html/cloudera-parcels/cdh5/5.15.1/
sudo mv *.parcel* /var/www/html/cloudera-parcels/cdh5/5.15.1/
sudo mv manifest.json /var/www/html/cloudera-parcels/cdh5/5.15.1/
sudo chmod -R ugo+rX /var/www/html/cloudera-parcels/cdh5/5.15.1/

</code></pre></td></tr></table></div></div><blockquote><p>5.15.1 替换为你的版本 (如 5.14.0)</p></blockquote><p>访问<a href=http://192.168.181.128/cloudera-parcels/cdh5/5.15.1 target=_blank rel="noopener noreffer">cdh_parcels</a></p><h2 id=设置ntp集群时间同步>设置NTP(集群时间同步)</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1>#服务端(master)</span>
yum install -y chrony

vi /etc/chrony.conf
<span class=c1># 注释以下四个外网时间同步服务器,并添加master机器为时间同步服务器</span>
<span class=c1># Use public servers from the pool.ntp.org project.</span>
<span class=c1># Please consider joining the pool (http://www.pool.ntp.org/join.html).</span>
<span class=c1>#server 0.centos.pool.ntp.org iburst</span>
<span class=c1>#server 1.centos.pool.ntp.org iburst</span>
<span class=c1>#server 2.centos.pool.ntp.org iburst</span>
<span class=c1>#server 3.centos.pool.ntp.org iburst</span>
server 192.168.181.128 iburst

<span class=c1># 重启服务</span>
systemctl restart chronyd
chronyc -a makestep
chronyc sources -v

</code></pre></td></tr></table></div></div><h2 id=优化内核参数>优化内核参数</h2><h3 id=关闭ipv6>关闭ipv6</h3><p>cat&#187;/etc/sysctl.conf&#171;EOF
####################### 自行添加 ###########################
#关闭ipv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
####################### 自行添加 ###########################
EOF</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>
## 安装expect, 执行脚本(仅master)
```bash
# 上传脚本及hostname文件
yum -y install expect

chmod +x InstallCDH_SSH.sh

./InstallCDH_SSH.sh root root hostsname.txt 

</code></pre></td></tr></table></div></div><h2 id=jdk准备脚本中已有spark2依赖jdk8所以自定义安装8>jdk准备(脚本中已有,spark2依赖jdk8,所以自定义安装8)</h2><h2 id=cmcms安装>cm/cms安装</h2><blockquote><p>前置要求: 配置cm,cdh的repo(rpm)库</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>sudo yum install -y cloudera-manager-daemons cloudera-manager-server

</code></pre></td></tr></table></div></div><h2 id=databaseconnector-安装相关数据库准备>database,connector 安装,相关数据库准备</h2><h3 id=安装和配置数据库>安装和配置数据库</h3><blockquote><p>为Cloudera Software安装和配置MariaDB<br>cloudera建议的配置文件在centos7.5自带5.x mariadb下无法启动,可能需要只适合10.x版本</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 安装,开机自启,启动</span>
sudo yum install -y mariadb-server
sudo systemctl <span class=nb>enable</span> mariadb
sudo systemctl start mariadb

<span class=c1># 停止数据库服务,mariadb配置文件`/etc/my.cnf`,修改内容为</span>
&gt;这个配置文件不适用与centos7自带5.x mariadb
sudo systemctl stop mariadb
mv /etc/my.cnf /etc/my.cnfbak
<span class=c1>############################################# 这个配置文件不适用与5.x mariadb</span>
cat&gt;/etc/my.cnf<span class=s>&lt;&lt;EOF
</span><span class=s>[mysqld]
</span><span class=s>datadir=/var/lib/mysql
</span><span class=s>socket=/var/lib/mysql/mysql.sock
</span><span class=s>transaction-isolation = READ-COMMITTED
</span><span class=s># Disabling symbolic-links is recommended to prevent assorted security risks;
</span><span class=s># to do so, uncomment this line:
</span><span class=s>symbolic-links = 0
</span><span class=s># Settings user and group are ignored when systemd is used.
</span><span class=s># If you need to run mysqld under a different user or group,
</span><span class=s># customize your systemd unit file for mariadb according to the
</span><span class=s># instructions in http://fedoraproject.org/wiki/Systemd
</span><span class=s>
</span><span class=s>key_buffer = 16M
</span><span class=s>key_buffer_size = 32M
</span><span class=s>max_allowed_packet = 32M
</span><span class=s>thread_stack = 256K
</span><span class=s>thread_cache_size = 64
</span><span class=s>query_cache_limit = 8M
</span><span class=s>query_cache_size = 64M
</span><span class=s>query_cache_type = 1
</span><span class=s>
</span><span class=s>max_connections = 550
</span><span class=s>#expire_logs_days = 10
</span><span class=s>#max_binlog_size = 100M
</span><span class=s>
</span><span class=s>#log_bin should be on a disk with enough free space.
</span><span class=s>#Replace &#39;/var/lib/mysql/mysql_binary_log&#39; with an appropriate path for your
</span><span class=s>#system and chown the specified folder to the mysql user.
</span><span class=s>log_bin=/var/lib/mysql/mysql_binary_log
</span><span class=s>
</span><span class=s>#In later versions of MariaDB, if you enable the binary log and do not set
</span><span class=s>#a server_id, MariaDB will not start. The server_id must be unique within
</span><span class=s>#the replicating group.
</span><span class=s>server_id=1
</span><span class=s>
</span><span class=s>binlog_format = mixed
</span><span class=s>
</span><span class=s>read_buffer_size = 2M
</span><span class=s>read_rnd_buffer_size = 16M
</span><span class=s>sort_buffer_size = 8M
</span><span class=s>join_buffer_size = 8M
</span><span class=s>
</span><span class=s># InnoDB settings
</span><span class=s>innodb_file_per_table = 1
</span><span class=s>innodb_flush_log_at_trx_commit  = 2
</span><span class=s>innodb_log_buffer_size = 64M
</span><span class=s>innodb_buffer_pool_size = 4G
</span><span class=s>innodb_thread_concurrency = 8
</span><span class=s>innodb_flush_method = O_DIRECT
</span><span class=s>innodb_log_file_size = 512M
</span><span class=s>
</span><span class=s>[mysqld_safe]
</span><span class=s>log-error=/var/log/mariadb/mariadb.log
</span><span class=s>pid-file=/var/run/mariadb/mariadb.pid
</span><span class=s>
</span><span class=s>#
</span><span class=s># include all files from the config directory
</span><span class=s>#
</span><span class=s>!includedir /etc/my.cnf.d
</span><span class=s>EOF</span>

<span class=c1># 修改完配置后重新启动数据库</span>
sudo systemctl start mariadb

<span class=c1># 运行脚本 为MariaDB进行初始化,包括设置root密码和一些选项:(^mariadbtxzpw01&amp;FR)</span>
sudo /usr/bin/mysql_secure_installation

</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 输出如下
[...]
Enter current password for root (enter for none):
OK, successfully used password, moving on...
[...]
Set root password? [Y/n] Y
New password:
Re-enter new password:
[...]
Remove anonymous users? [Y/n] Y
[...]
Disallow root login remotely? [Y/n] N
[...]
Remove test database and access to it [Y/n] Y
[...]
Reload privilege tables now? [Y/n] Y
[...]
All done!  If you&#39;ve completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!

</code></pre></td></tr></table></div></div><h3 id=为mariadb安装mysql-jdbc驱动程序>为MariaDB安装MySQL JDBC驱动程序</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 前置要求: 将下载的Connector上传到http的softwares目录中</span>
curl http://192.168.181.128/softwares/mysql-connector-java-5.1.47.tar.gz -O --progress 
tar zxvf mysql-connector-java-5.1.47.tar.gz
sudo mkdir -p /usr/share/java/
<span class=nb>cd</span> mysql-connector-java-5.1.47
sudo cp mysql-connector-java-5.1.47-bin.jar /usr/share/java/mysql-connector-java.jar

</code></pre></td></tr></table></div></div><h3 id=为cloudera-software创建数据库元数据库>为Cloudera Software创建数据库(元数据库)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 登陆mariadb</span>
mysql -u root -p
<span class=c1># 输入密码(^mariadbtxzpw01&amp;FR)</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 执行以下sql,完成创建数据库,创建用户,授予权限
CREATE DATABASE scm DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON scm.* TO &#39;scm&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE amon DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON amon.* TO &#39;amon&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE rman DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON rman.* TO &#39;rman&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE hue DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON hue.* TO &#39;hue&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE metastore DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON metastore.* TO &#39;hive&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE sentry DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON sentry.* TO &#39;sentry&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE nav DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON nav.* TO &#39;nav&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE navms DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON navms.* TO &#39;navms&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
CREATE DATABASE oozie DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
GRANT ALL ON oozie.* TO &#39;oozie&#39;@&#39;%&#39; IDENTIFIED BY &#39;^cdhtxzpw01&amp;FR&#39;;
SHOW DATABASES;
# 查看所有用户
SELECT DISTINCT CONCAT(&#39;User: &#39;&#39;&#39;,user,&#39;&#39;&#39;@&#39;&#39;&#39;,host,&#39;&#39;&#39;;&#39;) AS query FROM mysql.user;
# 可以查看某用户的权限信息
SHOW GRANTS FOR &#39;scm&#39;@&#39;%&#39;;

</code></pre></td></tr></table></div></div><h3 id=设置cloudera-manager数据库>设置Cloudera Manager数据库</h3><blockquote><p>前置要求: 安装cms,创建cms数据库,mariadb与cms在同一主机上,如果不在,参考官方文档<br>备注: cms包含一个可以为自己创建和配置数据库的脚本scm_prepare_database.sh</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 对上一步创建的数据库依次运行下面的命令</span>
<span class=c1>#sudo /usr/share/cmf/schema/scm_prepare_database.sh &lt;databaseType&gt; &lt;databaseName&gt; &lt;databaseUser&gt;</span>
<span class=c1># &lt;databaseName&gt;是cms要使用的数据库,其会在其中创建一些表用来保存管理数据等,如果指定-p -u选项,这回创建这个数据库</span>
<span class=c1># &lt;databaseType&gt;填mysql</span>
<span class=c1># &lt;databaseUser&gt;要创建或使用scm数据库的用户名,[创建权限的时候已经默认创建了该用户]</span>


<span class=c1># 例如,出现提示后输入scm数据库的访问密码(^cdhtxzpw01&amp;FR)</span>
sudo /usr/share/cmf/schema/scm_prepare_database.sh mysql scm scm

<span class=c1># 上一步中,如果没有创建cms数据库,则必须使用 -u -p 选项来创建cms数据库,命令如下</span>
sudo /usr/share/cmf/schema/scm_prepare_database.sh mysql -uroot -p
</code></pre></td></tr></table></div></div><p>输出如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>[root@foo-1 yangzhaoyunfei]# sudo /usr/share/cmf/schema/scm_prepare_database.sh mysql scm scm
Enter SCM password: 
JAVA_HOME=/usr/java/jdk1.8.0_162
Verifying that we can write to /etc/cloudera-scm-server
Creating SCM configuration file in /etc/cloudera-scm-server
Executing:  /usr/java/jdk1.8.0_162/bin/java -cp /usr/share/java/mysql-connector-java.jar:/usr/share/java/oracle-connector-java.jar:/usr/share/java/postgresql-connector-java.jar:/usr/share/cmf/schema/../lib/* com.cloudera.enterprise.dbutil.DbCommandExecutor /etc/cloudera-scm-server/db.properties com.cloudera.cmf.db.
[                          main] DbCommandExecutor              INFO  Successfully connected to database.
All done, your SCM database is configured correctly!
</code></pre></td></tr></table></div></div><h2 id=安装cdh>安装cdh</h2><blockquote><p>前置要求: 系统环境,jdk,database,connector,元数据库,配置cdh的repo(rpm)/http(parcel)库;数据库;数据库连接驱动,cms</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 启动cms</span>
sudo systemctl start cloudera-scm-server

<span class=c1># 查看启动日志</span>
sudo tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log

</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># 输入如下, 日志出现 Started Jetty server. ,启动成功
[yangzhaoyunfei@foo-1 ~]$ sudo tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log
2018-08-29 14:00:36,582 INFO SearchRepositoryManager-0:com.cloudera.server.web.cmf.search.components.SearchRepositoryManager: Generating entities:2018-08-29T06:00:36.582Z
2018-08-29 14:00:36,590 INFO SearchRepositoryManager-0:com.cloudera.server.web.cmf.search.components.SearchRepositoryManager: Num entities:208
2018-08-29 14:00:36,590 INFO SearchRepositoryManager-0:com.cloudera.server.web.cmf.search.components.SearchRepositoryManager: Generating documents:2018-08-29T06:00:36.590Z
2018-08-29 14:00:36,630 INFO SearchRepositoryManager-0:com.cloudera.server.web.cmf.search.components.SearchRepositoryManager: Num docs:221
2018-08-29 14:00:36,630 INFO SearchRepositoryManager-0:com.cloudera.server.web.cmf.search.components.SearchRepositoryManager: Constructing repo:2018-08-29T06:00:36.630Z
2018-08-29 14:00:37,249 INFO WebServerImpl:org.mortbay.log: jetty-6.1.26.cloudera.4
2018-08-29 14:00:37,261 INFO WebServerImpl:org.mortbay.log: Started SelectChannelConnector@0.0.0.0:7180
2018-08-29 14:00:37,261 INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server. #出现这句启动成功
2018-08-29 14:00:37,356 INFO SearchRepositoryManager-0:com.cloudera.server.web.cmf.search.components.SearchRepositoryManager: Finished constructing repo:2018-08-29T06:00:37.356Z
2018-08-29 14:00:42,368 INFO ScmActive-0:com.cloudera.server.cmf.components.ScmActive: ScmActive completed successfully.

</code></pre></td></tr></table></div></div><p>浏览器打开<a href=http://192.168.181.128:7180 target=_blank rel="noopener noreffer">安装界面</a>进行安装</p><h3 id=设置本地-parcel-存储库-url>设置本地 parcel 存储库 url</h3><ol><li><code>群集安装-->选择存储库-->选择方法</code></li><li><code>使用 Parcel (建议)</code> , <code>更多选项</code></li><li><code>删除所有远程 Parcel 存储库 URL</code></li><li>添加本地parcel库地址 <code>http://192.168.181.128/cloudera-parcels/cdh5/5.15.1/</code></li><li>其他 <code>Spark 2,Sqoop Connectors,cdh5</code> 等组件设置等同.</li><li>选择您要安装在主机上的 Cloudera Manager Agent 特定发行版,<code>自定义存储库</code></li><li>agent存储库地址为上面配置过的cm repo地址 <code>http://192.168.181.128/cm/5/</code></li><li>因为配置过<code>ssh互信</code>,<code>提供 SSH 登录凭据</code> 选择 <code>接受相同私钥,把master的私钥下载后选中</code></li></ol><h3 id=如果之前安装了jdk-jdk选择页面-不要勾选-安装jdk>如果之前安装了jdk, jdk选择页面 <code>不要勾选</code> <code>安装JDK</code></h3><h3 id=单用户模式配置复杂不要勾选>单用户模式配置复杂,不要勾选</h3><h3 id=install-agents>Install Agents</h3><h3 id=正在安装选定-parcel>正在安装选定 Parcel</h3><h3 id=检查主机正确性>检查主机正确性</h3><p>解决检查出的问题后继续</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text>Cloudera 建议将 /proc/sys/vm/swappiness 设置为最大值 10。当前设置为 60。使用 sysctl 命令在运行时更改该设置并编辑 /etc/sysctl.conf，以在重启后保存该设置。您可以继续进行安装，但 Cloudera Manager 可能会报告您的主机由于交换而运行状况不良。以下主机将受到影响： 
 查看详细信息
foo-[1-3].mycluster.com
已启用透明大页面压缩，可能会导致重大性能问题。请运行&#34;echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag&#34;和&#34;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#34;以禁用此设置，然后将同一命令添加到 /etc/rc.local 等初始化脚本中，以便在系统重启时予以设置。以下主机将受到影响: 
 查看详细信息
foo-[1-3].mycluster.com
</code></pre></td></tr></table></div></div><h3 id=数据库设置>数据库设置</h3><p>查看前面相关的数据库设置</p><h3 id=审核更改>审核更改</h3><p>保持默认即可</p><h3 id=首次运行-命令>首次运行 命令</h3><p>等待部署完成</p><h3 id=恭喜>恭喜</h3><h3 id=系统配置优化可选>系统配置优化(可选)</h3><ol><li>修改最大线程数IO等限制(暂不进行)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>vi /etc/systemd/system.conf
<span class=c1># 修改如下内容</span>
<span class=nv>DefaultLimitCORE</span><span class=o>=</span>infinity
<span class=nv>DefaultLimitNOFILE</span><span class=o>=</span><span class=m>100000</span>
<span class=nv>DefaultLimitNPROC</span><span class=o>=</span><span class=m>100000</span>

</code></pre></td></tr></table></div></div><ol start=2><li>关闭THP(脚本中已有)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 检查状态</span>
cat /sys/kernel/mm/transparent_hugepage/defrag
<span class=c1># output: [always] madvise never</span>
cat /sys/kernel/mm/transparent_hugepage/enabled
<span class=c1># output: [always] madvise never</span>

<span class=c1># 修改启动脚本,每次开机都禁用它们</span>
cat&gt;&gt;/etc/rc.d/rc.local<span class=s>&lt;&lt;EOF
</span><span class=s>####################### 自行添加 ###########################
</span><span class=s>if test -f /sys/kernel/mm/transparent_hugepage/enabled; then
</span><span class=s>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</span><span class=s>fi
</span><span class=s>if test -f /sys/kernel/mm/transparent_hugepage/defrag; then
</span><span class=s>echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
</span><span class=s>fi
</span><span class=s>####################### 自行添加 ###########################
</span><span class=s>EOF</span>

chmod +x /etc/rc.d/rc.local
reboot
</code></pre></td></tr></table></div></div><ol><li>内核参数优化(暂不进行,应该由专业运维人员来做)</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># 添加以下内容</span>
cat&gt;&gt;/etc/sysctl.conf<span class=s>&lt;&lt;EOF
</span><span class=s>####################### 自行添加 ###########################
</span><span class=s>#关闭ipv6
</span><span class=s>net.ipv6.conf.all.disable_ipv6 = 1
</span><span class=s>net.ipv6.conf.default.disable_ipv6 = 1
</span><span class=s># 避免放大攻击
</span><span class=s>net.ipv4.icmp_echo_ignore_broadcasts = 1
</span><span class=s># 开启恶意icmp错误消息保护
</span><span class=s>net.ipv4.icmp_ignore_bogus_error_responses = 1
</span><span class=s>#关闭路由转发
</span><span class=s>net.ipv4.ip_forward = 0
</span><span class=s>net.ipv4.conf.all.send_redirects = 0
</span><span class=s>net.ipv4.conf.default.send_redirects = 0
</span><span class=s>#开启反向路径过滤
</span><span class=s>net.ipv4.conf.all.rp_filter = 1
</span><span class=s>net.ipv4.conf.default.rp_filter = 1
</span><span class=s>#处理无源路由的包
</span><span class=s>net.ipv4.conf.all.accept_source_route = 0
</span><span class=s>net.ipv4.conf.default.accept_source_route = 0
</span><span class=s>#关闭sysrq功能
</span><span class=s>kernel.sysrq = 0
</span><span class=s>#core文件名中添加pid作为扩展名
</span><span class=s>kernel.core_uses_pid = 1
</span><span class=s># 开启SYN洪水攻击保护
</span><span class=s>net.ipv4.tcp_syncookies = 1
</span><span class=s>#修改消息队列长度
</span><span class=s>kernel.msgmnb = 65536
</span><span class=s>kernel.msgmax = 65536
</span><span class=s>#设置最大内存共享段大小bytes
</span><span class=s>kernel.shmmax = 68719476736
</span><span class=s>kernel.shmall = 4294967296
</span><span class=s>#timewait的数量，默认180000
</span><span class=s>net.ipv4.tcp_max_tw_buckets = 6000
</span><span class=s>net.ipv4.tcp_sack = 1
</span><span class=s>net.ipv4.tcp_window_scaling = 1
</span><span class=s>net.ipv4.tcp_rmem = 4096 87380 4194304
</span><span class=s>net.ipv4.tcp_wmem = 4096 16384 4194304
</span><span class=s>net.core.wmem_default = 8388608
</span><span class=s>net.core.rmem_default = 8388608
</span><span class=s>net.core.rmem_max = 16777216
</span><span class=s>net.core.wmem_max = 16777216
</span><span class=s>#每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目
</span><span class=s>net.core.netdev_max_backlog = 262144
</span><span class=s>#限制仅仅是为了防止简单的DoS 攻击
</span><span class=s>net.ipv4.tcp_max_orphans = 3276800
</span><span class=s>#未收到客户端确认信息的连接请求的最大值
</span><span class=s>net.ipv4.tcp_max_syn_backlog = 262144
</span><span class=s>net.ipv4.tcp_timestamps = 0
</span><span class=s>#内核放弃建立连接之前发送SYNACK 包的数量
</span><span class=s>net.ipv4.tcp_synack_retries = 1
</span><span class=s>#内核放弃建立连接之前发送SYN 包的数量
</span><span class=s>net.ipv4.tcp_syn_retries = 1
</span><span class=s>#启用timewait 快速回收
</span><span class=s>net.ipv4.tcp_tw_recycle = 1
</span><span class=s>#开启重用。允许将TIME-WAIT sockets 重新用于新的TCP 连接
</span><span class=s>net.ipv4.tcp_tw_reuse = 1
</span><span class=s>net.ipv4.tcp_mem = 94500000 915000000 927000000
</span><span class=s>net.ipv4.tcp_fin_timeout = 1
</span><span class=s>#当keepalive 起用的时候，TCP 发送keepalive 消息的频度。缺省是2 小时
</span><span class=s>net.ipv4.tcp_keepalive_time = 30
</span><span class=s>#允许系统打开的端口范围
</span><span class=s>net.ipv4.ip_local_port_range = 1024 65000
</span><span class=s>#修改防火墙表大小，默认65536
</span><span class=s>
</span><span class=s>#系统级别的能够打开的文件句柄的数量,ulimit 是进程级别的
</span><span class=s>fs.file-max = 265535
</span><span class=s>#系统允许的最大跟踪连接条目。在/etc/sysctl.conf文件中增加此属性，并运行&gt;/sbin/sysctl.conf –p
</span><span class=s>net.ipv4.ip_conntrack_max=265535
</span><span class=s>
</span><span class=s># 确保无人能修改路由表
</span><span class=s>net.ipv4.conf.all.accept_redirects = 0
</span><span class=s>net.ipv4.conf.default.accept_redirects = 0
</span><span class=s>net.ipv4.conf.all.secure_redirects = 0
</span><span class=s>net.ipv4.conf.default.secure_redirects = 0
</span><span class=s>net.nf_conntrack_max = 6553600
</span><span class=s>
</span><span class=s># 如果在sysctl -p的时候报error: &#39;net.ipv4.ip_conntrack_max&#39; is an unknown key ,通过以下命令向内核中加入模块修正：
</span><span class=s>modprobe ip_conntrack
</span><span class=s>echo &#34;modprobe ip_conntrack&#34; &gt;&gt; /etc/rc.local
</span><span class=s># net.netfilter.nf_conntrack_max=655350
</span><span class=s># net.netfilter.nf_conntrack_tcp_timeout_established=1200
</span><span class=s>####################### 自行添加 ###########################
</span><span class=s>EOF</span>

<span class=c1># 从/etc/sysctl.conf加载内核参数</span>
sysctl -p

</code></pre></td></tr></table></div></div><p>1.Disable the tuned Service(暂不进行)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-bash data-lang=bash>systemctl start tuned
tuned-adm off
tuned-adm list
<span class=c1># 输出中应该包含如下字样</span>
<span class=c1># No current active profile</span>
systemctl stop tuned
systemctl disable tuned

</code></pre></td></tr></table></div></div><p>8.系统优化 ALL
禁用交换分区
sysctl -w vm.swappiness=0
禁用透明大页面
echo never > /sys/kernel/mm/transparent_hugepage/defrag</p><h2 id=待完善>待完善</h2><ol><li>chrony时间同步存在问题,显示不可达</li><li>linux系统还有几项可以优化</li><li>脚本还需加入上面的修改项</li></ol><h2 id=附件>附件</h2><h3 id=附件1>附件1</h3><p>InstallCDH_SSH.sh 文件内容如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span><span class=lnt>343
</span><span class=lnt>344
</span><span class=lnt>345
</span><span class=lnt>346
</span><span class=lnt>347
</span><span class=lnt>348
</span><span class=lnt>349
</span><span class=lnt>350
</span><span class=lnt>351
</span><span class=lnt>352
</span><span class=lnt>353
</span><span class=lnt>354
</span><span class=lnt>355
</span><span class=lnt>356
</span><span class=lnt>357
</span><span class=lnt>358
</span><span class=lnt>359
</span><span class=lnt>360
</span><span class=lnt>361
</span><span class=lnt>362
</span><span class=lnt>363
</span><span class=lnt>364
</span><span class=lnt>365
</span><span class=lnt>366
</span><span class=lnt>367
</span><span class=lnt>368
</span><span class=lnt>369
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell><span class=cp>#!/bin/bash
</span><span class=cp></span>
<span class=c1># 该脚本的参数有三个,username,password,hostnames-file:</span>
<span class=c1># hostnames-file 内容示例,如:</span>
<span class=c1># 192.168.181.128=foo-1.mycluster.com</span>
<span class=c1># 192.168.181.129=foo-2.mycluster.com</span>
<span class=c1># 192.168.181.130=foo-3.mycluster.com</span>
<span class=c1># 192.168.181.131=foo-4.mycluster.com</span>
<span class=c1># 192.168.181.132=foo-5.mycluster.com</span>
<span class=c1># 192.168.181.133=foo-6.mycluster.com</span>
<span class=c1># 192.168.181.134=foo-7.mycluster.com</span>
<span class=c1># 192.168.181.135=foo-8.mycluster.com</span>
<span class=c1># 192.168.181.136=foo-9.mycluster.com</span>
# 
<span class=c1># 该脚本执行前需要按说明文档中先完成前置工作:</span>
<span class=c1># 1.createhostfile()中,</span>
<span class=c1># 2.createssh()中,</span>
<span class=c1># 3.createssh()中,repo文件,jdk文件需要放到第一台机器的httpd服务器中,供其所有机器下载</span>

<span class=k>if</span> <span class=o>[</span> <span class=nv>$#</span> -ne <span class=m>3</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># 如果传入的参数不是3个</span>
    <span class=nb>echo</span> <span class=s2>&#34;Usage:&#34;</span>
    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2>  linuxuser linuxpasswd hostsFile&#34;</span>
    <span class=nb>exit</span> <span class=m>1</span>
<span class=k>fi</span>

<span class=c1># 获取参数</span>
<span class=nv>linuxuser</span><span class=o>=</span><span class=nv>$1</span>
<span class=nv>linuxpasswd</span><span class=o>=</span><span class=nv>$2</span>
<span class=nv>hostfilename</span><span class=o>=</span><span class=nv>$3</span>

<span class=c1># 创建/etc/hosts文件,这个函数仅操作第一台机器</span>
createhostfile<span class=o>()</span>
<span class=o>{</span>
<span class=c1># 读取变量1个字符的变量,并赋给answer</span>
<span class=nb>read</span> -n <span class=m>1</span> -p <span class=s2>&#34;需要重置host文件吗？(y/n)?&#34;</span> answer

<span class=k>case</span> <span class=nv>$answer</span> in
Y <span class=p>|</span> y<span class=o>)</span>
        <span class=nb>local</span> <span class=nv>hostfile</span><span class=o>=</span><span class=nv>$1</span> <span class=c1># 局部变量</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ================================================&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 01 开始生成 /etc/hosts 文件&#34;</span>
        cat /dev/null&gt;/etc/hosts <span class=c1># 清空hosts文件</span>
        <span class=nb>echo</span> <span class=s2>&#34;127.0.0.1 localhost&#34;</span>
        <span class=k>for</span> line in <span class=sb>`</span>cat <span class=nv>$hostfile</span><span class=sb>`</span>
        <span class=k>do</span> 
            <span class=nv>ip</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$line</span><span class=p>|</span>awk -F<span class=s1>&#39;=&#39;</span> <span class=s1>&#39;{print $1}&#39;</span><span class=sb>`</span>
            <span class=nv>hostname</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$line</span><span class=p>|</span>awk -F<span class=s1>&#39;=&#39;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
            <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$ip</span><span class=s2> </span><span class=nv>$hostname</span><span class=s2>&#34;</span>&gt;&gt;/etc/hosts <span class=c1># 追加</span>
        <span class=k>done</span>  
        <span class=nb>echo</span> <span class=s2>&#34;127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4&#34;</span>&gt;&gt;/etc/hosts
        <span class=nb>echo</span> <span class=s2>&#34;::1         localhost localhost.localdomain localhost6 localhost6.localdomain6&#34;</span>&gt;&gt;/etc/hosts
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 01 生成 /etc/hosts 文件完成，请查看&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; =========================&#34;</span>
        cat /etc/hosts
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; =========================&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34;&#34;</span>
        <span class=nb>read</span> -n1 -p <span class=s2>&#34;请确认是否正确？(y/n)?&#34;</span> answer
        <span class=k>case</span> <span class=nv>$answer</span> in
        Y <span class=p>|</span> y<span class=o>)</span>
              <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 01 生成 /etc/hosts 文件完成&#34;</span>
              <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ================================================&#34;</span> 
              <span class=p>;;</span>
        N <span class=p>|</span> n<span class=o>)</span>
              <span class=nb>echo</span> <span class=s2>&#34;请确认传入参数文件是否正确&#34;</span>
              <span class=nb>exit</span> <span class=m>1</span>
              <span class=p>;;</span>
        *<span class=o>)</span>
              <span class=nb>echo</span> <span class=s2>&#34;error choice&#34;</span>
              <span class=nb>exit</span> <span class=m>1</span>
              <span class=p>;;</span>
        <span class=k>esac</span>  
      <span class=p>;;</span>
N <span class=p>|</span> n<span class=o>)</span>
      <span class=nb>echo</span> <span class=s2>&#34;跳过&#34;</span> 
      <span class=p>;;</span> 
<span class=k>esac</span>  



<span class=o>}</span>



<span class=c1># 免密登陆,这里只需在一个主机上信任自身,然后拷贝到其他机器上,即可完成整个集群的互信</span>
createssh<span class=o>()</span>
<span class=o>{</span>

<span class=nb>read</span> -n <span class=m>1</span> -p <span class=s2>&#34;需要重置SSH吗？(y/n)?&#34;</span> answer

<span class=k>case</span> <span class=nv>$answer</span> in
Y <span class=p>|</span> y<span class=o>)</span>
               
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ================================================&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 02 开始自动化建立SSH互信&#34;</span>
        <span class=nb>local</span> <span class=nv>DEST_USER</span><span class=o>=</span><span class=nv>$1</span>
        <span class=nb>local</span> <span class=nv>PASSWORD</span><span class=o>=</span><span class=nv>$2</span>
        <span class=nb>local</span> <span class=nv>HOSTS_FILE</span><span class=o>=</span><span class=nv>$3</span>
        <span class=k>if</span> <span class=o>[</span> <span class=nv>$#</span> -ne <span class=m>3</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>echo</span> <span class=s2>&#34;Usage:&#34;</span>
            <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$0</span><span class=s2> remoteUser remotePassword hostsFile&#34;</span>
            <span class=nb>exit</span> <span class=m>1</span>
        <span class=k>fi</span>

        <span class=nv>SSH_DIR</span><span class=o>=</span>~/.ssh
        <span class=nv>SCRIPT_PREFIX</span><span class=o>=</span>./tmp
        <span class=c1># 1. prepare  directory .ssh</span>
        mkdir <span class=nv>$SSH_DIR</span>
        chmod <span class=m>700</span> <span class=nv>$SSH_DIR</span>

        <span class=c1># 2. generat ssh key</span>
        <span class=nv>TMP_SCRIPT</span><span class=o>=</span><span class=nv>$SCRIPT_PREFIX</span>.sh <span class=c1># ./tmp.sh</span>
        <span class=nb>echo</span>  <span class=s2>&#34;#!/usr/bin/expect&#34;</span>&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=nb>echo</span>  <span class=s2>&#34;spawn ssh-keygen -b 1024 -t rsa&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=nb>echo</span>  <span class=s2>&#34;expect *key*&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span> <span class=c1># 检测到&#39;key&#39;</span>
        <span class=nb>echo</span>  <span class=s2>&#34;send \r&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=k>if</span> <span class=o>[</span> -f <span class=nv>$SSH_DIR</span>/id_rsa <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># 检测文件是否为普通文件</span>
            <span class=nb>echo</span>  <span class=s2>&#34;expect *verwrite*&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
            <span class=nb>echo</span>  <span class=s2>&#34;send y\r&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=k>fi</span>
        <span class=nb>echo</span>  <span class=s2>&#34;expect *passphrase*&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=nb>echo</span>  <span class=s2>&#34;send \r&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=nb>echo</span>  <span class=s2>&#34;expect *again:&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=nb>echo</span>  <span class=s2>&#34;send \r&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
        <span class=nb>echo</span>  <span class=s2>&#34;interact&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>

        chmod +x <span class=nv>$TMP_SCRIPT</span>

        /usr/bin/expect <span class=nv>$TMP_SCRIPT</span>
        rm <span class=nv>$TMP_SCRIPT</span>

        <span class=c1>################### 3. generat file authorized_keys</span>
        cat <span class=nv>$SSH_DIR</span>/id_rsa.pub&gt;&gt;<span class=nv>$SSH_DIR</span>/authorized_keys <span class=c1># 将本机id加到信任列表</span>

        <span class=c1>################### 4. chmod 600 for file authorized_keys</span>
        chmod <span class=m>600</span> <span class=nv>$SSH_DIR</span>/authorized_keys
        <span class=nb>echo</span> <span class=s2>&#34;===========================&#34;</span>
        
        <span class=c1>################### 5. copy all files to other hosts</span>
        <span class=k>for</span> ip in <span class=sb>`</span>cat <span class=nv>$HOSTS_FILE</span><span class=p>|</span>awk -F<span class=s1>&#39;=&#39;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>  <span class=c1># 对每个主机搜索</span>
        <span class=k>do</span>
            <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$ip</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># ip不为空</span>
                <span class=nb>echo</span> -------------------------
                <span class=nv>TMP_SCRIPT</span><span class=o>=</span><span class=si>${</span><span class=nv>SCRIPT_PREFIX</span><span class=si>}</span>.<span class=nv>$ip</span>.sh
                <span class=c1># check known_hosts</span>
                <span class=nv>val</span><span class=o>=</span><span class=sb>`</span>ssh-keygen -F <span class=nv>$ip</span><span class=sb>`</span> <span class=c1># 在 know_hosts 中 find 指定 hostname</span>
                <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$val</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># 没有搜索到</span>
                    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$ip</span><span class=s2> not in </span><span class=nv>$SSH_DIR</span><span class=s2>/known_hosts, need to add&#34;</span>
                    <span class=nv>val</span><span class=o>=</span><span class=sb>`</span>ssh-keyscan <span class=nv>$ip</span> 2&gt;/dev/null<span class=sb>`</span> <span class=c1># 扫描该主机中的公钥,标错输出到空</span>
                    <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$val</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=c1># 如果没有扫描到</span>
                        <span class=nb>echo</span> <span class=s2>&#34;ssh-keyscan </span><span class=nv>$ip</span><span class=s2> failed!&#34;</span>
                    <span class=k>else</span>
                        <span class=nb>echo</span> <span class=nv>$val</span>&gt;&gt;<span class=nv>$SSH_DIR</span>/known_hosts <span class=c1># 将扫描到的公钥添加到</span>
                    <span class=k>fi</span>
                <span class=k>fi</span>
                <span class=nb>echo</span> <span class=s2>&#34;copy </span><span class=nv>$SSH_DIR</span><span class=s2> to </span><span class=nv>$ip</span><span class=s2>&#34;</span> 
                        
                <span class=nb>echo</span>  <span class=s2>&#34;#!/usr/bin/expect&#34;</span>&gt;<span class=nv>$TMP_SCRIPT</span>
                <span class=nb>echo</span>  <span class=s2>&#34;spawn scp -r  </span><span class=nv>$SSH_DIR</span><span class=s2> </span><span class=nv>$DEST_USER</span><span class=s2>@</span><span class=nv>$ip</span><span class=s2>:~/&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
                <span class=nb>echo</span>  <span class=s2>&#34;expect *assword*&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
                <span class=nb>echo</span>  <span class=s2>&#34;send </span><span class=nv>$PASSWORD</span><span class=s2>\r&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span>
                <span class=nb>echo</span>  <span class=s2>&#34;interact&#34;</span>&gt;&gt;<span class=nv>$TMP_SCRIPT</span> <span class=c1># 执行完成后保持交互状态，把控制权交给控制台，这个时候就可以手工操作了</span>
                
                chmod +x <span class=nv>$TMP_SCRIPT</span>
            
                /usr/bin/expect <span class=nv>$TMP_SCRIPT</span>
                rm <span class=nv>$TMP_SCRIPT</span>
                <span class=nb>echo</span> <span class=s2>&#34;copy done.&#34;</span>                
            <span class=k>fi</span>
        <span class=k>done</span>

        <span class=nb>echo</span> <span class=k>done</span>.
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 02 建立SSH互信完成，开始验证互信情况&#34;</span>

        <span class=k>for</span> ip in <span class=sb>`</span>cat <span class=nv>$HOSTS_FILE</span><span class=p>|</span>awk -F<span class=s1>&#39;=&#39;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
        <span class=k>do</span>
           <span class=nv>localDATE</span><span class=o>=</span><span class=sb>`</span>date +%Y%m%d<span class=sb>`</span>
           <span class=nv>REMOTEDATE</span><span class=o>=</span><span class=sb>`</span>ssh <span class=si>${</span><span class=nv>ip</span><span class=si>}</span> date +%Y%m%d<span class=sb>`</span>
           <span class=k>if</span> <span class=o>[</span> <span class=si>${</span><span class=nv>localDATE</span><span class=si>}</span><span class=o>==</span><span class=si>${</span><span class=nv>REMOTEDATE</span><span class=si>}</span> <span class=o>]</span><span class=p>;</span><span class=k>then</span>
                <span class=nb>echo</span> <span class=s2>&#34;主机与远程IP：</span><span class=si>${</span><span class=nv>ip</span><span class=si>}</span><span class=s2> 连通测试成功&#34;</span>
           <span class=k>else</span>
                <span class=nb>echo</span> <span class=s2>&#34;主机与远程IP：</span><span class=si>${</span><span class=nv>ip</span><span class=si>}</span><span class=s2> 连通测试失败&#34;</span>
           <span class=k>fi</span>
        <span class=k>done</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 02 验证互信情况完成&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ================================================&#34;</span>
        <span class=nb>read</span> -n <span class=m>1</span> -p <span class=s2>&#34;请确认互信情况是否正确？(y/n)?&#34;</span> answer
        <span class=k>case</span> <span class=nv>$answer</span> in
        Y <span class=p>|</span> y<span class=o>)</span>
              <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 02 建立SSH互信完成，验证互信成功&#34;</span>
              <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ================================================&#34;</span>
              <span class=p>;;</span>
        N <span class=p>|</span> n<span class=o>)</span>
              <span class=nb>echo</span> <span class=s2>&#34;请定位问题&#34;</span>
              <span class=nb>exit</span> <span class=m>1</span>
              <span class=p>;;</span>
        *<span class=o>)</span>
              <span class=nb>echo</span> <span class=s2>&#34;error choice&#34;</span>
              <span class=nb>exit</span> <span class=m>1</span>
              <span class=p>;;</span>
        <span class=k>esac</span> 
      <span class=p>;;</span>
N <span class=p>|</span> n<span class=o>)</span>
      <span class=nb>echo</span> <span class=s2>&#34;跳过SSH互信&#34;</span> 
      <span class=p>;;</span> 
<span class=k>esac</span>  

 

<span class=o>}</span>


<span class=c1># 设置主机名</span>
changeHostName<span class=o>()</span>
<span class=o>{</span>


<span class=nb>read</span> -n <span class=m>1</span> -p <span class=s2>&#34;需要对每台主机名进行配置吗？(y/n)?&#34;</span> answer


<span class=k>case</span> <span class=nv>$answer</span> in
Y <span class=p>|</span> y<span class=o>)</span>

    <span class=nb>local</span> <span class=nv>HOSTS_FILE</span><span class=o>=</span><span class=nv>$1</span>
    <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ================================================&#34;</span>
    <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 03 开始修改主机名并分发host文件&#34;</span>
    cat&gt;&gt;/etc/profile<span class=s>&lt;&lt;EOF
</span><span class=s>################################ 自行添加 ###########################
</span><span class=s>
</span><span class=s>export JAVA_HOME=/usr/java/jdk1.8.0_162
</span><span class=s>PATH=\$PATH:\$JAVA_HOME/bin/;
</span><span class=s>export PATH
</span><span class=s>
</span><span class=s>
</span><span class=s>################################ 自行添加 ###########################
</span><span class=s>EOF</span>
    <span class=k>for</span> line in <span class=sb>`</span>cat <span class=nv>$HOSTS_FILE</span><span class=sb>`</span>
    <span class=k>do</span> 
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#34;</span> 
        <span class=nv>ip</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$line</span><span class=p>|</span>awk -F<span class=s1>&#39;=&#39;</span> <span class=s1>&#39;{print $1}&#39;</span><span class=sb>`</span> <span class=c1># =为分隔符</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; 开始处理 </span><span class=nv>$ip</span><span class=s2>&#34;</span>
        <span class=nv>hostname</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$line</span><span class=p>|</span>awk -F<span class=s1>&#39;=&#39;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=sb>`</span>
        <span class=nv>originhostsname</span><span class=o>=</span><span class=sb>`</span>ssh <span class=si>${</span><span class=nv>ip</span><span class=si>}</span> hostnamectl --static<span class=sb>`</span>  
        <span class=k>if</span> <span class=o>[</span> ! <span class=si>${</span><span class=nv>hostname</span><span class=si>}</span> <span class=o>==</span> <span class=si>${</span><span class=nv>originhostsname</span><span class=si>}</span> <span class=o>]</span><span class=p>;</span><span class=k>then</span>
            <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2> 需要修改Host&#34;</span> 
            ssh <span class=nv>$ip</span> <span class=s2>&#34;hostnamectl set-hostname </span><span class=nv>$hostname</span><span class=s2>&#34;</span>
            <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2> 修改完毕&#34;</span>
        <span class=k>else</span>
            <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2> 不需要修改Hostname&#34;</span> 
        <span class=k>fi</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始发送hosts文件&#34;</span>
        scp /etc/hosts root@<span class=nv>$hostname</span>:/etc/
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始发送repo文件&#34;</span> 
        <span class=c1>######################## 这个http的repo需要实现准备好 #########################################</span>
        scp /etc/yum.repos.d/http.repo  root@<span class=nv>$hostname</span>:/etc/yum.repos.d 
        <span class=nv>files</span><span class=o>=</span><span class=s2>&#34;/etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-CR.repo /etc/yum.repos.d/CentOS-Debuginfo.repo /etc/yum.repos.d/CentOS-fasttrack.repo /etc/yum.repos.d/CentOS-Media.repo /etc/yum.repos.d/CentOS-Sources.repo /etc/yum.repos.d/CentOS-Vault.repo&#34;</span>
        <span class=k>for</span> file in <span class=nv>$files</span> <span class=p>;</span><span class=k>do</span> ssh <span class=nv>$ip</span> <span class=s2>&#34;mv </span><span class=nv>$file</span><span class=s2> </span><span class=si>${</span><span class=nv>file</span><span class=si>}</span><span class=s2>bak&#34;</span> <span class=p>;</span><span class=k>done</span> <span class=c1># 备份原有repo</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始处理yum&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;yum clean all&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;yum makecache&#34;</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始处理SELINUX&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;setenforce 0&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;sed -i &#39;/SELINUX/s/enforcing/disabled/&#39; /etc/selinux/config&#34;</span> <span class=c1># 将文本中的en..替换成dis..</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始处理防火墙&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl stop firewalld&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl disable firewalld&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl status firewalld&#34;</span>
        
        <span class=c1>############################ 这里是不是跟 这里换用了chrony,而不是老的ntp ##################################</span>
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始处理NTP时钟同步&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;yum install -y chrony&#34;</span>
        scp /etc/chrony.conf root@<span class=nv>$hostname</span>:/etc/
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl restart chronyd&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;chronyc sources&#34;</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始下载JDK包并解压&#34;</span> 
        <span class=c1># 从预先配置好的apache下载jdk,这里官方文档没有谈到环境变量的问题,但我们应该配置上环境变量,因为其他组件,或者一些自己安装的软件会使用java</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;mkdir -p /usr/java/&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rm -rf  /usr/java/jdk-8u162*&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;curl http://192.168.181.128/softwares/jdk-8u162-linux-x64.tar.gz -o /opt/jdk-8u162-linux-x64.tar.gz --progress&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;tar -zxf /opt/jdk-8u162-linux-x64.tar.gz -C /usr/java/&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始卸载OPENJDK&#34;</span>
         <span class=c1># mini install 没有jdk,但不同的centos版本,要写在的软件包不同,下面列举的是centos7.4de1</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rpm -e --nodeps java-1.8.0-openjdk-1.8.0.131-11.b12.el7.x86_64&#34;</span> <span class=c1># 强制卸载</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rpm -e --nodeps java-1.7.0-openjdk-1.7.0.141-2.6.10.5.el7.x86_64&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rpm -e --nodeps java-1.7.0-openjdk-headless-1.7.0.141-2.6.10.5.el7.x86_64&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.131-11.b12.el7.x86_64&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rpm -e --nodeps tzdata-java-2017b-1.el7.noarch&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;rpm -e --nodeps icedtea-web-1.6.2-4.el7.x86_64&#34;</span> 
        <span class=c1>#ssh $ip &#34;yum -y install jline*&#34; # ?????????????????</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始发送环境变量&#34;</span> <span class=c1># 如果要使用个命令,先要设置jdk环境变量</span>
        scp /etc/profile root@<span class=nv>$ip</span>:/etc/
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始发送环境生效并检查jdk版本信息&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;source /etc/profile &amp;&amp; java -version&#34;</span> 
        <span class=c1>#echo `date &#34;+%Y-%m-%d %H:%M:%S&#34;`&#34; $ip&#34;&#34; 检查JDK版本信息&#34;</span>
        <span class=c1>#ssh $ip &#34;java -version&#34;</span>
        
        <span class=c1>############################################## 参数调优部分结束 ####################################################</span>
        
        <span class=c1>#echo `date &#34;+%Y-%m-%d %H:%M:%S&#34;`&#34; $ip&#34;&#34; 修改系统限制&#34;</span>  
        <span class=c1>#scp /etc/systemd/system.conf root@$ip:/etc/systemd/</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 关闭THP&#34;</span> 
        scp /etc/rc.d/rc.local root@<span class=nv>$ip</span>:/etc/rc.d/
        ssh <span class=nv>$ip</span> <span class=s2>&#34;chmod +x /etc/rc.d/rc.local&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag&#34;</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 关闭交换分区&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;swapoff -a&#34;</span> 
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 关闭tuned调优&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl start tuned&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;tuned-adm off&#34;</span> 
        ssh <span class=nv>$ip</span> <span class=s2>&#34;tuned-adm list&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl stop tuned&#34;</span>
        ssh <span class=nv>$ip</span> <span class=s2>&#34;systemctl disable tuned&#34;</span>
        
        <span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n&#34;</span>
        <span class=nb>echo</span> <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 开始优化内核参数&#34;</span>
        scp /etc/sysctl.conf root@<span class=nv>$ip</span>:/etc/
        ssh <span class=nv>$ip</span> <span class=s2>&#34;sysctl -p&#34;</span>
        <span class=c1>#ssh $ip &#34;ulimit –n 265535&#34;</span>
        
        <span class=c1>############################################# 参数调优部分结束 ##################################################</span>
        
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; </span><span class=nv>$ip</span><span class=s2>&#34;&#34; 处理结束&#34;</span>
        <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#34;</span> 
        
        
    <span class=k>done</span>    
    <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34; step 03 修改hostname成功&#34;</span> 

    <span class=nb>echo</span> <span class=sb>`</span>date <span class=s2>&#34;+%Y-%m-%d %H:%M:%S&#34;</span><span class=sb>`</span><span class=s2>&#34;================================================&#34;</span>  
     <span class=p>;;</span>
N <span class=p>|</span> n<span class=o>)</span>
      <span class=nb>echo</span> <span class=s2>&#34;跳过对每台主机进行配置&#34;</span> 
      <span class=p>;;</span> 
<span class=k>esac</span> 


<span class=o>}</span>


main<span class=o>()</span>
<span class=o>{</span>

createhostfile <span class=nv>$hostfilename</span>
createssh <span class=nv>$linuxuser</span> <span class=nv>$linuxpasswd</span> <span class=nv>$hostfilename</span>
changeHostName <span class=nv>$hostfilename</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\n\n\n处理完成\n\n\n&#34;</span>
<span class=o>}</span>


main


</code></pre></td></tr></table></div></div><h3 id=附件2>附件2</h3><p>hostsname.txt 内容如下:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text>192.168.181.128=foo-1.mycluster.com
192.168.181.129=foo-2.mycluster.com
192.168.181.130=foo-3.mycluster.com
</code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2020-07-05&nbsp;<a class=git-hash href=https://github.com/yangzhaoyunfei/shell-blog.git/commit/df95df5a88adc81529d83d5e64aabdbb475fafb2 target=_blank title="commit by 唐忠维(yangzhaoyunfei@qq.com) df95df5a88adc81529d83d5e64aabdbb475fafb2: b">
<i class="fas fa-hashtag fa-fw"></i>df95df5</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/cdh_copy/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://yangzhaoyunfei.github.io/cdh_copy/ data-title=Hadoop-CDH发行版--集群离线部署教程 data-hashtags=大数据,Hadoop,部署><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://yangzhaoyunfei.github.io/cdh_copy/ data-hashtag=大数据><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://yangzhaoyunfei.github.io/cdh_copy/ data-title=Hadoop-CDH发行版--集群离线部署教程><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://yangzhaoyunfei.github.io/cdh_copy/ data-title=Hadoop-CDH发行版--集群离线部署教程><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://yangzhaoyunfei.github.io/cdh_copy/ data-title=Hadoop-CDH发行版--集群离线部署教程><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/>大数据</a>,&nbsp;<a href=/tags/hadoop/>Hadoop</a>,&nbsp;<a href=/tags/%E9%83%A8%E7%BD%B2/>部署</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/chocolatey-install/ class=prev rel=prev title="windows下, 使用choco安装开发环境"><i class="fas fa-angle-left fa-fw"></i>windows下, 使用choco安装开发环境</a>
<a href=/git/ class=next rel=next title=Git常用命令>Git常用命令<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.68.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://yangzhaoyunfei.github.io/about/ target=_blank>$hell</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"valine":{"appId":"LJx0vDYuOCS2WtVmAqHwaSCy-gzGzoHsz","appKey":"LUCUR8Vim8FVL3cny8NWO5HF","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-cn","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"visitor":true}},"search":{"algoliaAppID":"FU5LH5RZ1V","algoliaIndex":"index.zh-cn","algoliaSearchKey":"d3e0552bcf9b92495806330fdf567d02","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>